{% load mptt_tags %}
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title%}{% endblock%}Iwo Market Place</title>
    
    <!-- CSS Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/2.5.1/uicons-solid-rounded/css/uicons-solid-rounded.css'>
    <link rel="stylesheet" href="{% static 'css/styles.css'%}">

    <style>
        :root {
            /* Light Theme - Emerald Base */
            --light-primary-color: #2d6a4f;     /* Deep emerald - dominant */
            --light-secondary-color: #40916c;    /* Sage green */
            --light-accent-color: #b87333;       /* Copper accent */
            --light-background: #f8faf7;         /* Off-white with green tint */
            --light-card-background: #ffffff;
            --light-text-primary: #6a4a3a;       /* Dark emerald text */
            --light-text-secondary: #52796f;     /* Muted sage */
            --light-border-color: #74c69d;       /* Soft emerald border */
            --light-hover-bg: #e9f5f0;
            --light-success: #95d5b2;            /* Soft green success */
            --light-warning: #dda15e;            /* Copper-toned warning */
            --light-error: #bc6c25;              /* Deep copper error */
            --light-info: #83c5be;               /* Sage info */
            --light-muted: #b7e4c7;              /* Muted emerald */
            --light-shadow: rgba(45, 106, 79, 0.15);
            
            /* Dark Theme - Deep Emerald */
            --dark-primary-color: #1b4332;       /* Deep emerald - dominant */
            --dark-secondary-color: #2d6a4f;     /* Rich emerald */
            --dark-accent-color: #cd7f32;        /* Bright copper accent */
            --dark-background: #081c15;          /* Very dark emerald */
            --dark-card-background: #132a21;     /* Dark emerald surface */
            --dark-text-primary: #d8f3dc;        /* Light emerald text */
            --dark-text-secondary: #95d5b2;      /* Muted light emerald */
            --dark-border-color: #2d6a4f;        /* Emerald border */
            --dark-hover-bg: #1b4332;
            --dark-success: #40916c;             /* Deep success */
            --dark-warning: #bc6c25;             /* Deep copper warning */
            --dark-error: #ae2012;               /* Rust error */
            --dark-info: #264653;                /* Deep teal info */
            --dark-muted: #52796f;               /* Muted dark emerald */
            --dark-shadow: rgba(8, 28, 21, 0.3);
            
            /* Typography */
            --font-primary: 'Poppins', sans-serif;
            --font-secondary: 'Newsreader', serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            
            /* Spacing */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            
            /* Border Radius */
            --radius-sm: 0.25rem;
            --radius-md: 0.5rem;
            --radius-lg: 1rem;
            --radius-xl: 1.5rem;
            --radius-full: 9999px;
          }
          
          /* Theme Application */
          [data-bs-theme="light"] {
            --primary-color: var(--light-primary-color);
            --secondary-color: var(--light-secondary-color);
            --accent-color: var(--light-accent-color);
            --background-color: var(--light-background);
            --card-background: var(--light-card-background);
            --text-primary: var(--light-text-primary);
            --text-secondary: var(--light-text-secondary);
            --border-color: var(--light-border-color);
            --hover-bg: var(--light-hover-bg);
            --shadow-color: var(--light-shadow);
          }
          
          [data-bs-theme="dark"] {
            --primary-color: var(--dark-primary-color);
            --secondary-color: var(--dark-secondary-color);
            --accent-color: var(--dark-accent-color);
            --background-color: var(--dark-background);
            --card-background: var(--dark-card-background);
            --text-primary: var(--dark-text-primary);
            --text-secondary: var(--dark-text-secondary);
            --border-color: var(--dark-border-color);
            --hover-bg: var(--dark-hover-bg);
            --shadow-color: var(--dark-shadow);
          }
          
          /* Enhanced Base Styles */
          body {
            font-family: var(--font-primary);
            background-color: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
          }
          
          /* Content Wrapper with Advanced Layout */
          .content-wrapper {
            max-width: 1440px;
            margin: 0 auto;
            padding: var(--spacing-2xl);
            grid-template-columns: repeat(12, 1fr);
            gap: var(--spacing-lg);
          }
          
          /* Enhanced Card Styles */
          .card {
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 20px var(--shadow-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden;
          }
          
          .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px var(--shadow-color);
          }
          
          /* Advanced Button Styles */
          .btn-primary {
            background-color: var(--primary-color);
            color: #ffffff;
            border: none;
            padding: var(--spacing-sm) var(--spacing-xl);
            border-radius: var(--radius-md);
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
          }
          
          .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
          }
          
          .btn-primary::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 120%;
            height: 120%;
            background: rgba(255, 255, 255, 0.1);
            transform: translate(-50%, -50%) scale(0);
            border-radius: 50%;
            transition: transform 0.5s ease;
          }
          
          .btn-primary:active::after {
            transform: translate(-50%, -50%) scale(1);
          }
          
          /* Advanced Form Controls */
          .form-control {
            background-color: var(--card-background);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            border-radius: var(--radius-md);
            padding: var(--spacing-sm) var(--spacing-md);
            transition: all 0.3s ease;
          }
          
          .form-control:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(184, 115, 51, 0.2);
            outline: none;
          }
          
          /* Responsive Design */
          @media (max-width: 1200px) {
            .content-wrapper {
              padding: var(--spacing-xl);
              gap: var(--spacing-md);
            }
          }
          
          @media (max-width: 992px) {
            .content-wrapper {
              padding: var(--spacing-lg);
              grid-template-columns: repeat(8, 1fr);
            }
          }
          
          @media (max-width: 768px) {
            .content-wrapper {
              padding: var(--spacing-md);
              grid-template-columns: repeat(4, 1fr);
            }
          }
          
          @media (max-width: 576px) {
            .content-wrapper {
              padding: var(--spacing-sm);
              grid-template-columns: 1fr;
            }
            
            .btn-primary {
              width: 100%;
              margin-bottom: var(--spacing-sm);
            }
          }
          .alert {
            border: none;
            border-radius: var(--radius-lg);
            padding: var(--spacing-md) var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideIn 0.3s ease-out;
          }
          
          @keyframes slideIn {
            from {
              transform: translateY(-100%);
              opacity: 0;
            }
            to {
              transform: translateY(0);
              opacity: 1;
            }
          }
          
          .alert-info {
            background-color: var(--alert-info-bg, var(--light-alert-info-bg));
            border-left: 4px solid var(--info, var(--light-info));
          }
          
          .alert-success {
            background-color: var(--alert-success-bg, var(--light-alert-success-bg));
            border-left: 4px solid var(--success, var(--light-success));
          }
          
          .alert-warning {
            background-color: var(--alert-warning-bg, var(--light-alert-warning-bg));
            border-left: 4px solid var(--warning, var(--light-warning));
          }
          
          .alert-danger {
            background-color: var(--alert-error-bg, var(--light-alert-error-bg));
            border-left: 4px solid var(--error, var(--light-error));
          }
          
          .btn-close {
            opacity: 0.5;
            transition: opacity 0.3s ease;
          }
          
          .btn-close:hover {
            opacity: 1;
          }

    </style>
</head>
<body>
    {% block 'Navbar' %}
        {% include "navbar.html" %}
    {% endblock %}

    {% block 'messages' %}
        {% if messages %}
            <div class="content-wrapper">
                {% for message in messages %}
                    <div class="alert alert-info alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endblock %}

    <main class="content-wrapper">
        {% block 'Body' %}{% endblock %}
    </main>

    {% block 'Footer' %}
        {% include "footer.html" %}
    {% endblock %}

    <!-- Essential Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async></script>

    <!-- Theme Management Script -->
    <script>
        // Theme management class
        class ThemeManager {
            constructor() {
                this.html = document.documentElement;
                this.initialize();
            }

            initialize() {
                // Check for saved theme first
                const savedTheme = localStorage.getItem('theme');
                
                if (savedTheme) {
                    // Use saved theme if it exists
                    this.setTheme(savedTheme);
                } else {
                    // Otherwise use system preference
                    this.setThemeBasedOnSystem();
                }

                // Listen for system theme changes
                this.setupSystemThemeListener();
            }

            setThemeBasedOnSystem() {
                if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    this.setTheme('dark');
                } else {
                    this.setTheme('light');
                }
            }

            setupSystemThemeListener() {
                window.matchMedia('(prefers-color-scheme: dark)')
                    .addEventListener('change', e => {
                        // Only change theme if user hasn't set a preference
                        if (!localStorage.getItem('theme')) {
                            this.setTheme(e.matches ? 'dark' : 'light');
                        }
                    });
            }

            setTheme(theme) {
                this.html.setAttribute('data-bs-theme', theme);
                this.updateAllThemeToggles(theme);
            }

            toggleTheme() {
                const currentTheme = this.html.getAttribute('data-bs-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                this.setTheme(newTheme);
                localStorage.setItem('theme', newTheme);
            }

            updateAllThemeToggles(theme) {
                // Update all theme toggle icons on the page
                document.querySelectorAll('.theme-toggle-icon').forEach(icon => {
                    icon.className = `theme-toggle-icon bi ${theme === 'light' ? 'bi-moon-fill' : 'bi-sun-fill'}`;
                });
            }
        }

        // Initialize theme manager
        const themeManager = new ThemeManager();

        // Make themeManager available globally for other templates
        window.themeManager = themeManager;
    </script>
</body>
</html>