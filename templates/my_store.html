{% extends 'base.html' %}
{% load static %}
{% load compress %}

{% block page_css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/pages/my_store.css' %}">
{% endblock %}

{% block page_js %}
    <script type="text/javascript" src="{% static 'js/pages/my_store.js' %}"></script>
{% endblock %}

{% block 'Body' %}
<div class="store-container">
    <div class="store-header">
        <div class="container">
            <div class="row align-items-center py-4 py-md-5">
                <div class="col-12 text-center">
                    {% if store_owner.profile.photo %}
                        <img src="{{ store_owner.profile.photo.url }}" 
                            alt="Profile Photo" 
                            class="store-profile-photo">
                    {% else %}
                        <svg xmlns="http://www.w3.org/2000/svg" width="150" height="150" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="store-profile-photo">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    {% endif %}
                    <h1 class="profile-username mt-3">{{ store_owner.username }}'s Store</h1>
                    {% if store_owner.profile.bio %}
                        <p class="store-bio mb-3">{{ store_owner.profile.bio }}</p>
                    {% endif %}

                    {% if is_verified_business %}
                        <div class="business-info-section">
                            <h5>✅ Verified Business</h5>
                            <p><strong>{{ business_info.name }}</strong></p>
                            {% if business_info.email %}
                                <p>Email: {{ business_info.email }}</p>
                            {% endif %}
                            {% if business_info.phone %}
                                <p>Phone: {{ business_info.phone }}</p>
                            {% endif %}
                            {% if business_location_display %}
                                <p>Address: {{ business_location_display }}</p>
                            {% endif %}
                        </div>
                    {% elif has_pending_verification %}
                        <div class="pending-verification">
                            <p>⏳ Business verification pending</p>
                        </div>
                    {% else %}
                        {% if request.user == store_owner %}
                            <a href="{% url 'business_verification_form' %}" class="btn btn-primary">
                                Verify Your Business
                            </a>
                        {% endif %}
                    {% endif %}
        
                    {% if request.user == store_owner %}
                        <div class="profile-actions mt-4">
                            <a href="{% url 'product_create' %}" class="btn btn-add-product">
                                <span class="btn-icon">
                                    <i class="bi bi-plus-lg"></i>
                                    <i class="bi bi-box-seam"></i>
                                </span>
                                <span class="btn-text">Add Product</span>
                            </a>
                            <a href="{% url 'profile_update' %}" class="btn btn-edit-profile">
                                <span class="btn-icon">
                                    <i class="bi bi-pencil-fill"></i>
                                    <i class="bi bi-person-gear"></i>
                                </span>
                                <span class="btn-text">Edit Profile</span>
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>


    <div class="container">
        {% if request.user == store_owner %}
        <div class="info-item-card business-verification-card">
            <div class="info-item-header">
                <i class="bi bi-building"></i>
                <span class="info-label">Business Verification</span>
            </div>
            <div class="info-content">
                {% if store_owner.profile.is_verified_business %}
                    <div class="verified-section">
                        <span class="verification-badge verified">
                            <i class="bi bi-patch-check-fill"></i>
                            <span class="badge-text">Verified Business</span>
                        </span>
                        <p class="business-name">{{ store_owner.profile.business_name }}</p>
                    </div>
                {% elif store_owner.profile.has_pending_verification %}
                    <div class="pending-section">
                        <span class="verification-badge pending">
                            <i class="bi bi-clock-history"></i>
                            <span class="badge-text">Under Review</span>
                        </span>
                        <a href="{% url 'business_verification_status' %}" class="btn btn-sm btn-outline-info">
                            Check Status
                        </a>
                    </div>
                {% else %}
                    <div class="unverified-business-section">
                        <p class="mb-2">Verify your business to unlock premium features:</p>
                        <ul class="benefits-mini">
                            <li>Verified business badge</li>
                            <li>Permanent listings</li>
                            <li>Enhanced visibility</li>
                            <li>Priority Support</li>
                        </ul>
                        <a href="{% url 'business_verification_form' %}" class="btn btn-primary btn-sm">
                            <i class="bi bi-patch-check me-1"></i>
                            Verify Business
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        

        {% if request.user == store_owner %}
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card store-info-card">
                        <div class="card-body">
                            <h5 class="info-section-title mb-4">
                                <i class="bi bi-person-lines-fill me-2"></i>
                                My Information
                            </h5>

                            <div class="info-grid">
                                <div class="info-item-card">
                                    <div class="info-item-header">
                                        <i class="bi bi-person-circle"></i>
                                        <span class="info-label">Full Name</span>
                                    </div>
                                    <div class="info-content">
                                        {{ store_owner.get_full_name|default:"Not provided" }}
                                    </div>
                                </div>

                                <div class="info-item-card">
                                    <div class="info-item-header">
                                        <i class="bi bi-envelope"></i>
                                        <span class="info-label">Email Address</span>
                                    </div>
                                    <div class="info-content">
                                        <div class="email-wrapper">
                                            <span class="email-text">{{ store_owner.email }}</span>
                                            <div class="verification-status">
                                                {% if request.user.profile.email_verified %}
                                                    <span class="verification-badge verified" data-bs-toggle="tooltip" data-bs-placement="top" title="Email Verified">
                                                        <i class="bi bi-patch-check-fill"></i>
                                                        <span class="badge-text">Verified</span>
                                                    </span>
                                                {% else %}
                                                    <div class="unverified-section">
                                                        <span class="verification-badge unverified" data-bs-toggle="tooltip" data-bs-placement="top" title="Email Not Verified">
                                                            <i class="bi bi-patch-exclamation-fill"></i>
                                                            <span class="badge-text">Unverified</span>
                                                        </span>
                                                        <form class="verify-form" method="post" action="{% url 'send_verification_otp' %}">
                                                            {% csrf_token %}
                                                            <button type="submit" class="btn btn-verify">
                                                                <i class="bi bi-shield-check me-1"></i>
                                                                Verify Now
                                                            </button>
                                                        </form>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="info-item-card">
                                    <div class="info-item-header">
                                        <i class="bi bi-telephone"></i>
                                        <span class="info-label">Phone Number</span>
                                    </div>
                                    <div class="info-content">
                                        {{ store_owner.profile.phone_number|default:"Not provided" }}
                                    </div>
                                </div>

                                {% if store_owner.profile.location %}
                                <div class="info-item-card location-card">
                                    <div class="info-item-header">
                                        <i class="bi bi-geo-alt"></i>
                                        <span class="info-label">Location</span>
                                    </div>
                                    <div class="info-content">
                                        <div class="location-details">
                                            {% if store_owner.profile.location.address %}
                                                <div class="location-line">{{ store_owner.profile.location.address }}</div>
                                            {% endif %}
                                            {% if store_owner.profile.location.address_2 %}
                                                <div class="location-line">{{ store_owner.profile.location.address_2 }}</div>
                                            {% endif %}
                                            <div class="location-line">
                                                {% if store_owner.profile.location.city %}
                                                    {{ store_owner.profile.location.city }}
                                                    {% if store_owner.profile.location.lga %}, {% endif %}
                                                {% endif %}
                                                {% if store_owner.profile.location.lga %}
                                                    {{ store_owner.profile.location.lga.name }}
                                                {% endif %}
                                            </div>
                                            {% if store_owner.profile.location.state %}
                                                <div class="location-line">{{ store_owner.profile.location.state.name }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% else %}
                                <div class="info-item-card">
                                    <div class="info-item-header">
                                        <i class="bi bi-geo-alt"></i>
                                        <span class="info-label">Location</span>
                                    </div>
                                    <div class="info-content">
                                        Not provided
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}

        <div class="row">
            <div class="col-12">
                <div class="products-section">
                    <h3 class="h5 mb-3">Active Listings(
                        {{ total_products }} Product{{ total_products|pluralize }}
                     Listed)</h3>
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
                        {% for product in products %}
                            <div class="col-6 col-md-4 col-lg-3">
                                {% include 'product_card.html' with product=product %}
                            </div>
                        {% empty %}
                            <div class="col-12">
                                <div class="empty-products-card">
                                    <div class="empty-products-icon">
                                        <i class="bi bi-box2-heart"></i>
                                    </div>
                                    <h5>No products available yet</h5>
                                    <p class="text-muted">This store has no active listings at the moment</p>
                                    {% if request.user == store_owner %}
                                        <a href="{% url 'product_create' %}" class="btn btn-add-first-product">
                                            <i class="bi bi-plus-lg me-2"></i>
                                            Create Your First Listing
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block 'Footer'%}{% endblock %}