{% extends 'base.html' %}
{% load static %}
{% load compress %}

{% block page_css %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/pages/notifications/notification_list.css' %}">
{% endblock %}

{% block page_js %}
    <script type="text/javascript" src="{% static 'js/pages/notifications/notification_list.js' %}"></script>
{% endblock %}

{% block 'Body' %}
<div class="container-fluid py-3">
    <!-- Header Section -->
    <div class="notifications-header">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
            <div class="d-flex align-items-center">
                <h1 class="page-title">Notifications</h1>
                {% if notifications %}
                    <span class="notification-count">{{ notifications|length }}</span>
                {% endif %}
            </div>
            
            <div class="header-actions">
                {% if notifications %}
                    <button id="markAllReadBtn" class="btn btn-outline-primary action-btn">
                        <i class="bi bi-check-all me-1"></i>
                        <span class="btn-text">Mark All Read</span>
                    </button>
                    <button id="clearAllBtn" class="btn btn-outline-danger action-btn">
                        <i class="bi bi-trash3 me-1"></i>
                        <span class="btn-text">Clear All</span>
                    </button>
                {% endif %}
                <a href="{% url 'notifications:preferences' %}" class="btn btn-primary action-btn">
                    <i class="bi bi-gear-fill me-1"></i>
                    <span class="btn-text">Settings</span>
                </a>
            </div>
        </div>
    </div>
    
    <!-- Category Filter -->
    {% if categories %}
    <div class="category-filter-section">
        <div class="category-filters">
            <button type="button" class="filter-btn active" data-category="all">
                <i class="bi bi-grid-3x3-gap-fill me-1"></i>All
            </button>
            {% for category_id, category_name in categories %}
                <button type="button" class="filter-btn" data-category="{{ category_id }}">
                    {% if category_id == 'announcement' %}<i class="bi bi-megaphone-fill me-1"></i>
                    {% elif category_id == 'system' %}<i class="bi bi-gear-fill me-1"></i>
                    {% elif category_id == 'news' %}<i class="bi bi-newspaper me-1"></i>
                    {% else %}<i class="bi bi-bell-fill me-1"></i>{% endif %}
                    {{ category_name }}
                </button>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Notifications List -->
    <div class="notifications-container">
        {% if notifications %}
            <div id="notificationsList" class="notifications-list">
                {% for notification in notifications %}
                    <div class="notification-item" 
                         data-category="{{ notification.category }}" 
                         data-id="{{ notification.id }}">
                        
                        <!-- Unread Indicator -->
                        {% if not notification.is_read %}
                            <div class="unread-indicator"></div>
                        {% endif %}
                        
                        <a href="{% url 'notifications:detail' notification.id %}" class="notification-link">
                            <div class="notification-content-wrapper">
                                <!-- Icon and Content -->
                                <div class="notification-main">
                                    <div class="notification-icon">
                                        {% if notification.category == 'announcement' %}üì¢
                                        {% elif notification.category == 'system' %}‚öôÔ∏è
                                        {% elif notification.category == 'news' %}üì∞
                                        {% else %}üì¢{% endif %}
                                    </div>
                                    
                                    <div class="notification-content">
                                        <div class="notification-header-inline">
                                            <h3 class="notification-title">
                                                {% if not notification.is_read %}
                                                    <span class="new-indicator">NEW</span>
                                                {% endif %}
                                                {{ notification.title }}
                                            </h3>
                                            <span class="category-tag category-{{ notification.category }}">
                                                {{ notification.get_category_display }}
                                            </span>
                                        </div>
                                        
                                        <p class="notification-message">{{ notification.message|truncatewords:20 }}</p>
                                        
                                        <!-- Related Content Preview -->
                                        {% if notification.content_object %}
                                            <div class="related-preview">
                                                <i class="bi bi-link-45deg me-1"></i>
                                                <span class="related-text">
                                                    {% if notification.get_content_type_name == 'product_listing' %}
                                                        Product: {{ notification.content_object.title|truncatewords:6 }}
                                                    {% elif notification.get_content_type_name == 'review' %}
                                                        Review by {{ notification.content_object.reviewer.username }}
                                                    {% else %}
                                                        {{ notification.content_object|truncatewords:6 }}
                                                    {% endif %}
                                                </span>
                                            </div>
                                        {% endif %}
                                        
                                        <div class="notification-meta">
                                            <span class="timestamp">
                                                <i class="bi bi-clock me-1"></i>
                                                {{ notification.created_at|timesince }} ago
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Quick Actions -->
                                <div class="notification-actions">
                                    {% if not notification.is_read %}
                                        <button class="action-btn-sm mark-read-btn" 
                                                data-notification-id="{{ notification.id }}"
                                                title="Mark as read"
                                                onclick="event.stopPropagation(); event.preventDefault();">
                                            <i class="bi bi-check2"></i>
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        </a>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-icon">
                    <i class="bi bi-bell-slash"></i>
                </div>
                <h3 class="empty-title">No notifications yet</h3>
                <p class="empty-message">We'll notify you when something important happens with your listings and account.</p>
            </div>
        {% endif %}
    </div>

    <!-- Pagination -->
    {% if page_obj.has_other_pages %}
        <div class="pagination-wrapper">
            <nav aria-label="Notification pagination">
                <ul class="pagination">
                    {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">
                                <i class="bi bi-chevron-left"></i>
                            </a>
                        </li>
                    {% endif %}
                    
                    {% for num in page_obj.paginator.page_range %}
                        {% if num == page_obj.number %}
                            <li class="page-item active">
                                <span class="page-link">{{ num }}</span>
                            </li>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                            <li class="page-item">
                                <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ page_obj.next_page_number }}">
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    {% endif %}
</div>

{% endblock %}

{% block 'Footer' %}{% endblock %}