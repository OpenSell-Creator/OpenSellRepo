<div id="cookie-consent-banner" class="cookie-consent-banner">
    <div class="cookie-content">
        <div class="cookie-header">
            <div class="cookie-icon">
                <i class="bi bi-cookie"></i>
            </div>
            <h4 class="cookie-title">Cookie Notice</h4>
            <div class="cookie-close-mobile">
                <button type="button" class="cookie-close-btn" aria-label="Close">
                    <i class="bi bi-x"></i>
                </button>
            </div>
        </div>
        <div class="cookie-body">
            <p>We use cookies to enhance your browsing experience on our website. By continuing to use our site, you agree to our use of cookies. Our cookies help us understand how visitors interact with our site, remember your preferences, and provide you with a more personalized experience.</p>
        </div>
        <div class="cookie-actions">
            <button id="cookie-settings-banner"  class="btn btn-outline-secondary">Cookie Settings</button>
            <button id="reject-cookies" class="btn btn-outline-primary">Reject All</button>
            <button id="accept-cookies" class="btn btn-primary">Accept All</button>
        </div>
    </div>
</div>


<div id="cookie-settings-modal" class="cookie-settings-modal">
    <div class="cookie-settings-content">
        <div class="cookie-settings-header">
            <h4 class="modal-title">Cookie Preferences</h4>
            <button type="button" id="close-settings" class="cookie-close-btn" aria-label="Close">
                <i class="bi bi-x"></i>
            </button>
        </div>
        <div class="cookie-settings-body">
            <p class="settings-intro">Customize your cookie preferences. You can enable or disable different types of cookies below. Essential cookies cannot be disabled as they are necessary for the website to function properly.</p>
            
            <div class="cookie-type">
                <div class="cookie-type-header">
                    <div class="type-name">
                        <h5>Essential Cookies</h5>
                    </div>
                    <div class="type-toggle">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="essential-cookies" checked disabled>
                        </div>
                    </div>
                </div>
                <p class="cookie-type-description">These cookies are necessary for the website to function and cannot be switched off. They are usually only set in response to actions made by you which amount to a request for services.</p>
            </div>
            
            <div class="cookie-type">
                <div class="cookie-type-header">
                    <div class="type-name">
                        <h5>Functional Cookies</h5>
                    </div>
                    <div class="type-toggle">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="functional-cookies">
                        </div>
                    </div>
                </div>
                <p class="cookie-type-description">These cookies enable the website to provide enhanced functionality and personalization, such as remembering your preferences and settings.</p>
            </div>
            
            <div class="cookie-type">
                <div class="cookie-type-header">
                    <div class="type-name">
                        <h5>Analytics Cookies</h5>
                    </div>
                    <div class="type-toggle">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="analytics-cookies">
                        </div>
                    </div>
                </div>
                <p class="cookie-type-description">These cookies allow us to count visits and analyze traffic sources so we can measure and improve the performance of our site.</p>
            </div>
        </div>
        <div class="cookie-settings-footer">
            <div class="cookie-settings-actions">
                <button id="save-preferences" class="btn btn-primary">Save Preferences</button>
            </div>
            <div class="cookie-settings-links">
                <a href="{% url 'cookie_policy' %}" class="cookie-policy-link">View our Cookie Policy</a>
            </div>
        </div>
    </div>
</div>

<style>
    /* Cookie Consent Banner */
    .cookie-consent-banner {
        position: fixed;
        bottom: -100%;
        left: 0;
        right: 0;
        background-color: var(--card-background);
        box-shadow: 0 -4px 12px var(--shadow-color);
        z-index: 9999;
        padding: 1rem;
        transition: bottom 0.5s ease-in-out;
        border-top: 3px solid var(--primary-color);
    }
    
    .cookie-consent-banner.show {
        bottom: 0;
    }
    
    .cookie-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0.5rem;
    }
    
    .cookie-header {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .cookie-icon {
        background-color: var(--primary-color);
        color: #ffffff;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        font-size: 1.2rem;
    }
    
    .cookie-title {
        margin: 0;
        font-weight: 600;
        color: var(--text-primary);
    }
    
    .cookie-close-mobile {
        margin-left: auto;
        display: none;
    }
    
    .cookie-body {
        margin-bottom: 1.5rem;
        color: var(--text-primary);
    }
    
    .cookie-actions {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
    }
    
    /* Cookie Settings Modal */
    .cookie-settings-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    .cookie-settings-modal.show {
        opacity: 1;
        visibility: visible;
    }
    
    .cookie-settings-content {
        background-color: var(--card-background);
        border-radius: var(--radius-md);
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px var(--shadow-color);
    }
    
    .cookie-settings-header {
        padding: 1.25rem;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .cookie-settings-body {
        padding: 1.25rem;
    }
    
    .cookie-settings-footer {
        padding: 1.25rem;
        border-top: 1px solid var(--border-color);
    }
    
    .cookie-close-btn {
        background: transparent;
        border: none;
        font-size: 1.5rem;
        color: var(--text-secondary);
        cursor: pointer;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: color 0.2s ease;
    }
    
    .cookie-close-btn:hover {
        color: var(--text-primary);
    }
    
    .settings-intro {
        margin-bottom: 1.5rem;
        color: var(--text-primary);
    }
    
    .cookie-type {
        border: 1px solid var(--border-color);
        border-radius: var(--radius-sm);
        padding: 1rem;
        margin-bottom: 1rem;
    }
    
    .cookie-type-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.5rem;
    }
    
    .type-name h5 {
        margin: 0;
        font-weight: 600;
        font-size: 1rem;
        color: var(--text-primary);
    }
    
    .cookie-type-description {
        font-size: 0.9rem;
        color: var(--text-secondary);
        margin-bottom: 0;
    }
    
    .cookie-settings-actions {
        margin-bottom: 1rem;
    }
    
    .cookie-settings-links {
        text-align: center;
    }
    
    .cookie-policy-link {
        color: var(--primary-color);
        text-decoration: none;
        font-size: 0.9rem;
    }
    
    .cookie-policy-link:hover {
        text-decoration: underline;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .cookie-actions {
            flex-direction: column;
        }
        
        .cookie-actions button {
            width: 100%;
        }
        
        .cookie-close-mobile {
            display: block;
        }
    }
</style>
<script>
    // Save this as cookie_consent.js in your static/js directory

    // Cookie Consent JavaScript// Cookie Consent JavaScript
    document.addEventListener('DOMContentLoaded', function() {
        // Check if user has already made a choice
        const cookieConsent = localStorage.getItem('cookieConsent');
        
        if (cookieConsent === null) {
            // If no choice has been made, show the banner
            setTimeout(function() {
                document.getElementById('cookie-consent-banner').classList.add('show');
            }, 1000);
        } else {
            // Apply saved preferences
            applyStoredPreferences();
        }
        
        // Accept cookies
        document.getElementById('accept-cookies').addEventListener('click', function() {
            acceptCookies();
        });
        
        // Reject non-essential cookies
        document.getElementById('reject-cookies').addEventListener('click', function() {
            rejectCookies();
        });
        
        // Cookie settings button in the banner
        document.getElementById('cookie-settings-banner').addEventListener('click', function() {
            document.getElementById('cookie-consent-banner').classList.remove('show');
            showSettingsModal();
        });
        
        // Cookie settings button (standalone)
        if (document.getElementById('cookie-settings-btn')) {
            document.getElementById('cookie-settings-btn').addEventListener('click', function() {
                showSettingsModal();
            });
        }
        
        // Cookie settings footer link
        if (document.getElementById('cookie-settings-footer')) {
            document.getElementById('cookie-settings-footer').addEventListener('click', function(e) {
                e.preventDefault();
                showSettingsModal();
            });
        }
        
        // Close cookie settings modal
        document.getElementById('close-settings').addEventListener('click', function() {
            document.getElementById('cookie-settings-modal').classList.remove('show');
            
            // If user hasn't made a choice yet, show banner again
            if (localStorage.getItem('cookieConsent') === null) {
                document.getElementById('cookie-consent-banner').classList.add('show');
            }
        });
        
        // Save preferences from modal
        document.getElementById('save-preferences').addEventListener('click', function() {
            const functional = document.getElementById('functional-cookies').checked;
            const analytics = document.getElementById('analytics-cookies').checked;
            
            savePreferences(functional, analytics);
        });
    });

    function showSettingsModal() {
        // Load current preferences into checkboxes
        const functional = localStorage.getItem('functionalCookies') === 'true';
        const analytics = localStorage.getItem('analyticsCookies') === 'true';
        
        if (document.getElementById('functional-cookies')) {
            document.getElementById('functional-cookies').checked = functional;
        }
        
        if (document.getElementById('analytics-cookies')) {
            document.getElementById('analytics-cookies').checked = analytics;
        }
        
        // Show the modal
        document.getElementById('cookie-settings-modal').classList.add('show');
    }

    function acceptCookies() {
        // Set cookies and save preference
        localStorage.setItem('cookieConsent', 'accepted');
        localStorage.setItem('functionalCookies', 'true');
        localStorage.setItem('analyticsCookies', 'true');
        
        // Hide the banner with animation
        document.getElementById('cookie-consent-banner').classList.remove('show');
        
        // Enable all cookie types
        enableCookies('all');
        
        // Send to server if needed
        sendConsentToServer('accept');
    }

    function rejectCookies() {
        // Save preference but only allow essential cookies
        localStorage.setItem('cookieConsent', 'rejected');
        localStorage.setItem('functionalCookies', 'false');
        localStorage.setItem('analyticsCookies', 'false');
        
        // Hide the banner with animation
        document.getElementById('cookie-consent-banner').classList.remove('show');
        
        // Only enable essential cookies
        enableCookies('essential');
        
        // Send to server if needed
        sendConsentToServer('reject');
    }

    function savePreferences(functional, analytics) {
        // Save detailed preferences
        localStorage.setItem('cookieConsent', 'custom');
        localStorage.setItem('functionalCookies', functional ? 'true' : 'false');
        localStorage.setItem('analyticsCookies', analytics ? 'true' : 'false');
        
        // Hide the modal
        document.getElementById('cookie-settings-modal').classList.remove('show');
        
        // Enable appropriate cookies
        const cookieTypes = ['essential'];
        if (functional) cookieTypes.push('functional');
        if (analytics) cookieTypes.push('analytics');
        
        enableCookies(cookieTypes);
        
        // Send to server if needed
        sendConsentToServer('custom', {
            functional: functional,
            analytics: analytics
        });
    }

    function applyStoredPreferences() {
        // Apply the stored cookie preferences when page loads
        const consent = localStorage.getItem('cookieConsent');
        const functional = localStorage.getItem('functionalCookies') === 'true';
        const analytics = localStorage.getItem('analyticsCookies') === 'true';
        
        if (consent === 'accepted') {
            enableCookies('all');
        } else if (consent === 'rejected') {
            enableCookies('essential');
        } else if (consent === 'custom') {
            const cookieTypes = ['essential'];
            if (functional) cookieTypes.push('functional');
            if (analytics) cookieTypes.push('analytics');
            enableCookies(cookieTypes);
        }
    }

    function enableCookies(types) {
        // This function handles the actual enabling/disabling of different cookie types
        console.log('Enabling cookie types:', types);
        
        // Example: If you're using Google Analytics
        if (types === 'all' || (Array.isArray(types) && types.includes('analytics'))) {
            // Enable analytics
            initializeAnalytics();
        }
        
        // Enable functional cookies if needed
        if (types === 'all' || (Array.isArray(types) && types.includes('functional'))) {
            // Enable functional cookies
            initializeFunctionalCookies();
        }
    }

    function initializeAnalytics() {
        // Placeholder function to initialize analytics tools like Google Analytics
        // This is where you would add your analytics initialization code
        console.log('Analytics initialized');
        
        // Example Google Analytics initialization (commented out)
        /*
        if (typeof ga === 'undefined') {
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
            
            ga('create', 'UA-XXXXX-Y', 'auto');
            ga('send', 'pageview');
        }
        */
    }

    function initializeFunctionalCookies() {
        // Placeholder function to initialize functional cookies
        // This is where you would add code to enable functionality that uses cookies
        console.log('Functional cookies initialized');
    }

    function sendConsentToServer(consentType, details = {}) {
        // This function sends the user's consent to your server if needed
        // Get the CSRF token
        const csrfToken = getCsrfToken();
        
        // Prepare the data to send
        const data = {
            consent_type: consentType,
            details: details
        };
        
        // Send the POST request to your Django backend
        fetch('/api/cookie-consent/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            console.log('Consent saved:', data);
        })
        .catch(error => {
            console.error('Error saving consent:', error);
        });
    }

    function getCsrfToken() {
        // Get CSRF token from cookies
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, 'csrftoken='.length) === 'csrftoken=') {
                    cookieValue = decodeURIComponent(cookie.substring('csrftoken='.length));
                    break;
                }
            }
        }
        return cookieValue;
    }
</script>