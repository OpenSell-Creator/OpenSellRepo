{% if banners %}
<div class="banner-section" aria-label="Advertisement Banners">
    <div class="banner-container">
        {% for banner in banners %}
        <div class="banner-slide {% if forloop.first %}active{% endif %}" 
             data-index="{{ forloop.counter0 }}"
             role="group"
             aria-label="Banner slide {{ forloop.counter }} of {{ banners|length }}">
            <a href="{{ banner.url }}" class="banner-link" target="_blank" rel="noopener">
                <picture>
                    {% if banner.mobile_image %}
                    <source media="(max-width: 768px)" srcset="{{ banner.mobile_image.url }}">
                    {% endif %}
                    <img src="{{ banner.image.url }}" 
                         alt="{{ banner.title }}"
                         class="banner-image"
                         loading="{% if forloop.first %}eager{% else %}lazy{% endif %}">
                </picture>
                <div class="banner-content">
                    <h2 class="banner-title">{{ banner.title }}</h2>
                    {% if banner.subtitle %}
                    <p class="banner-subtitle">{{ banner.subtitle }}</p>
                    {% endif %}
                </div>
            </a>
        </div>
        {% endfor %}
        
        <div class="banner-controls">
            <button class="nav-button prev-button" aria-label="Previous banner">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                </svg>
            </button>
            <button class="nav-button next-button" aria-label="Next banner">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/>
                </svg>
            </button>
        </div>

        <div class="banner-progress">
            {% for banner in banners %}
            <div class="progress-dot {% if forloop.first %}active{% endif %}"
                 data-index="{{ forloop.counter0 }}">
                <div class="progress-inner"></div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>


<style>
    /* Banner Section */
    .banner-section {
        margin: 1rem auto;
        max-width: 1440px;
        padding: 0 1rem;
    }

    .banner-container {
        position: relative;
        border-radius: 1rem;
        overflow: hidden;
        aspect-ratio: 21/9;
        background: var(--background-color);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        touch-action: pan-y pinch-zoom;
    }

    .banner-slide {
        position: absolute;
        inset: 0;
        opacity: 0;
        transition: opacity 0.5s ease;
        transform: translateZ(0);
    }

    .banner-slide.active {
        opacity: 1;
        z-index: 1;
    }

    .banner-link {
        display: block;
        height: 100%;
        text-decoration: none;
        color: inherit;
    }

    .banner-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .banner-content {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 2rem;
        background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
        color: white;
    }

    .banner-title {
        font-size: 1.5rem;
        margin: 0;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
    }

    .banner-subtitle {
        font-size: 1rem;
        margin:  0 0;
        opacity: 0.9;
    }

    .banner-controls {
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        transform: translateY(-50%);
        z-index: 2;
        display: flex;
        justify-content: space-between;
        padding: 0 1rem;
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
    }

    .banner-container:hover .banner-controls {
        opacity: 50%;
        pointer-events: auto;
    }

    .banner-progress {
        position: absolute;
        bottom: 0.5rem;
        left: 0;
        right: 0;
        z-index: 2;
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        opacity: 25%;
    }

    .progress-dot {
        width: 20px;
        height: 4px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 2px;
        overflow: hidden;
    }

    .progress-dot.active .progress-inner {
        width: 100%;
        height: 100%;
        background: white;
        transform-origin: left;
        animation: progress 5s linear;
    }

    @keyframes progress {
        from { transform: scaleX(0); }
        to { transform: scaleX(1); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .banner-container {
            aspect-ratio: 16/9;
            border-radius: 0.5rem;
        }

        .banner-content {
            padding: 0.65rem;
        }

        .banner-title {
            font-size: 0.75rem;
        }

        .banner-subtitle {
            font-size: 0.5rem;
        }

        .banner-controls {
            display: none;
        }
    }
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const bannerContainer = document.querySelector('.banner-container');
    if (!bannerContainer) return;

    const slides = bannerContainer.querySelectorAll('.banner-slide');
    const progressDots = bannerContainer.querySelectorAll('.progress-dot');
    const prevButton = bannerContainer.querySelector('.prev-button');
    const nextButton = bannerContainer.querySelector('.next-button');
    let currentSlide = 0;
    let autoplayInterval;
    let touchStartX = 0;
    let touchEndX = 0;
    let isDragging = false;

    function showSlide(index, resetProgress = true) {
        slides[currentSlide].classList.remove('active');
        progressDots[currentSlide].classList.remove('active');
        
        currentSlide = (index + slides.length) % slides.length;
        
        slides[currentSlide].classList.add('active');
        progressDots[currentSlide].classList.add('active');
        
        if (resetProgress) {
            const dot = progressDots[currentSlide];
            const inner = dot.querySelector('.progress-inner');
            inner.style.animation = 'none';
            inner.offsetHeight; // Trigger reflow
            inner.style.animation = null;
        }
    }

    function nextSlide() {
        showSlide(currentSlide + 1);
    }

    function prevSlide() {
        showSlide(currentSlide - 1);
    }

    function startAutoplay() {
        stopAutoplay();
        autoplayInterval = setInterval(nextSlide, 5000);
    }

    function stopAutoplay() {
        if (autoplayInterval) {
            clearInterval(autoplayInterval);
        }
    }

    // Enhanced touch events
    bannerContainer.addEventListener('touchstart', (e) => {
        touchStartX = e.touches[0].clientX;
        isDragging = true;
        stopAutoplay();
    }, { passive: true });

    bannerContainer.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        e.preventDefault();
        touchEndX = e.touches[0].clientX;
    }, { passive: false });

    bannerContainer.addEventListener('touchend', () => {
        if (!isDragging) return;
        isDragging = false;
        const diff = touchStartX - touchEndX;

        if (Math.abs(diff) > 50) {
            if (diff > 0) {
                nextSlide();
            } else {
                prevSlide();
            }
        }
        startAutoplay();
    });

    // Button controls
    prevButton?.addEventListener('click', () => {
        prevSlide();
        startAutoplay();
    });

    nextButton?.addEventListener('click', () => {
        nextSlide();
        startAutoplay();
    });

    // Progress dots
    progressDots.forEach((dot, index) => {
        dot.addEventListener('click', () => {
            showSlide(index);
            startAutoplay();
        });
    });

    // Pause on hover
    bannerContainer.addEventListener('mouseenter', stopAutoplay);
    bannerContainer.addEventListener('mouseleave', startAutoplay);

    // Start autoplay
    startAutoplay();
});
</script>
{% endif %}