{% extends 'base.html' %}

{% block title %}Campaign Details{% endblock %}

{% block 'Body' %}
<div class="container my-5">
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="mb-0">{{ campaign.title }}</h4>
            {% if campaign.status == 'draft' %}
                <span class="badge bg-secondary fs-6">Draft</span>
            {% elif campaign.status == 'sending' %}
                <span class="badge bg-warning fs-6">
                    <span class="spinner-border spinner-border-sm" role="status"></span>
                    Sending...
                </span>
            {% else %}
                <span class="badge bg-success fs-6">‚úì Sent</span>
            {% endif %}
        </div>
        <div class="card-body">
            <!-- Campaign Info -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <p><strong>Type:</strong> <span class="badge bg-info">{{ campaign.get_campaign_type_display }}</span></p>
                    <p><strong>Subject:</strong> {{ campaign.subject }}</p>
                    <p><strong>Status:</strong> 
                        {% if campaign.status == 'draft' %}
                            <span class="text-secondary">Draft</span>
                        {% elif campaign.status == 'sending' %}
                            <span class="text-warning">Sending in progress...</span>
                        {% else %}
                            <span class="text-success">‚úì Completed</span>
                        {% endif %}
                    </p>
                </div>
                <div class="col-md-6">
                    <p><strong>Total Sent:</strong> 
                        <span class="badge bg-primary fs-6">{{ campaign.total_sent }}</span> users
                    </p>
                    <p><strong>Created:</strong> {{ campaign.created_at|date:"F d, Y H:i" }}</p>
                    {% if campaign.sent_at %}
                    <p><strong>Completed:</strong> {{ campaign.sent_at|date:"F d, Y H:i" }}</p>
                    {% endif %}
                    <p><strong>Created by:</strong> {{ campaign.created_by.username }}</p>
                </div>
            </div>

            <!-- Targeting Info -->
            <div class="alert alert-info">
                <strong>üìä Targeting:</strong>
                {% if campaign.target_all %}All users{% endif %}
                {% if campaign.verified_only %}, Verified emails only{% endif %}
                {% if campaign.business_only %}, Business accounts only{% endif %}
            </div>
            
            <hr>
            
            <!-- Message Preview -->
            <h5>üìß Message Content:</h5>
            <div class="border rounded p-3 bg-light">
                {{ campaign.message|safe }}
            </div>
            
            <!-- Action Buttons -->
            <div class="mt-4 d-flex gap-2">
                {% if campaign.status == 'draft' %}
                <a href="{% url 'bulk_email_send_now' campaign.pk %}" class="btn btn-warning btn-lg">
                    ‚ö° Send Now ({{ campaign.get_recipient_count }} recipients)
                </a>
                {% elif campaign.status == 'sending' %}
                <button class="btn btn-warning btn-lg" disabled>
                    <span class="spinner-border spinner-border-sm" role="status"></span>
                    Sending in progress...
                </button>
                {% endif %}
                
                <a href="{% url 'bulk_email_list' %}" class="btn btn-outline-secondary btn-lg">
                    ‚Üê Back to List
                </a>
            </div>
        </div>
    </div>
</div>

{% if campaign.status == 'sending' %}
<script>
// Auto-refresh every 5 seconds while campaign is sending
setTimeout(() => {
    window.location.reload();
}, 5000);

// Show a small notification
const notification = document.createElement('div');
notification.className = 'alert alert-warning position-fixed bottom-0 end-0 m-3';
notification.style.zIndex = '9999';
notification.innerHTML = `
    <small>
        <span class="spinner-border spinner-border-sm me-2"></span>
        Campaign is sending... Auto-refreshing in 5s
    </small>
`;
document.body.appendChild(notification);
</script>
{% endif %}
{% endblock %}

{% block 'Footer'%}
{% endblock%}